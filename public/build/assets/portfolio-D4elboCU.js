const m=(t,e)=>{let n;return function(...o){const i=()=>{clearTimeout(n),t(...o)};clearTimeout(n),n=setTimeout(i,e)}},f=(t,e)=>{let n;return function(...o){n||(t(...o),n=!0,setTimeout(()=>n=!1,e))}};document.addEventListener("DOMContentLoaded",()=>{p()});function p(){y(),g(),v(),h(),E(),b(),L(),I(),x(),A()}function y(){const t=document.querySelectorAll(".view-btn[data-view]"),e=document.getElementById("projectsContainer");t.forEach(n=>{n.addEventListener("click",()=>{const s=n.dataset.view;t.forEach(o=>o.classList.remove("active")),n.classList.add("active"),e.className=s==="list"?"projects-grid list-view":"projects-grid"})})}function g(){const t=document.querySelectorAll(".filter-btn"),e=document.getElementById("projectSearch");t.forEach(n=>{n.addEventListener("click",()=>{const s=n.dataset.filter;t.forEach(o=>o.classList.remove("active")),n.classList.add("active"),l(e.value.toLowerCase(),s)})})}function v(){document.querySelectorAll(".sort-option").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.sort;C(n)})})}function h(){const t=document.getElementById("projectSearch"),e=t.nextElementSibling,n=m(s=>{const o=document.querySelector(".filter-btn.active").dataset.filter;l(s,o),S(s)},300);t.addEventListener("input",s=>{n(s.target.value.toLowerCase())}),document.addEventListener("click",s=>{!t.contains(s.target)&&!e.contains(s.target)&&(e.style.display="none")})}function E(){const t=document.querySelectorAll(".view-btn[data-project]"),e=document.getElementById("projectDetailsModal");let n=0;t.forEach(i=>{i.addEventListener("click",async()=>{const a=i.dataset.project;try{const c=await fetch(`/projects/${a}`);if(!c.ok)throw new Error("Network response was not ok");const r=await c.json();q(r),e.classList.add("active")}catch(c){console.error("Error:",c),showToast("Failed to load project details. Please try again.","error")}})});const s=e.querySelector(".gallery-nav.prev"),o=e.querySelector(".gallery-nav.next");if(s&&o){const i=f(a=>{const c=e.querySelectorAll(".thumbnail");n=(n+a+c.length)%c.length,k(n)},300);s.addEventListener("click",()=>i(-1)),o.addEventListener("click",()=>i(1))}e.querySelector(".close-btn").addEventListener("click",()=>{e.classList.remove("active")}),e.addEventListener("click",i=>{i.target===e&&e.classList.remove("active")})}function b(){const t=new IntersectionObserver(e=>{e.forEach(n=>{n.isIntersecting&&(n.target.classList.add("visible"),t.unobserve(n.target))})},{threshold:.1,rootMargin:"50px"});document.querySelectorAll(".project-card").forEach(e=>{t.observe(e)})}function L(){document.querySelectorAll(".stat-value").forEach(e=>{const n=parseInt(e.dataset.count),o=n/(2e3/16);let i=0;const a=()=>{i+=o,i<n?(e.textContent=Math.floor(i),requestAnimationFrame(a)):e.textContent=n};new IntersectionObserver((r,d)=>{r.forEach(u=>{u.isIntersecting&&(a(),d.unobserve(u.target))})},{threshold:.5}).observe(e)})}function l(t,e){const n=document.querySelectorAll(".project-card"),s=document.createDocumentFragment();n.forEach(o=>{const i=o.querySelector(".project-title").textContent.toLowerCase(),a=o.querySelector(".project-description").textContent.toLowerCase(),c=o.dataset.category;(i.includes(t)||a.includes(t))&&(e==="all"||c===e)?(o.style.display="",s.appendChild(o),requestAnimationFrame(()=>o.classList.add("visible"))):(o.classList.remove("visible"),requestAnimationFrame(()=>o.style.display="none"))}),document.getElementById("projectsContainer").appendChild(s)}function S(t){const e=document.querySelector(".search-suggestions"),n=document.querySelectorAll(".project-card");if(t.length<2){e.style.display="none";return}const s=Array.from(n).filter(o=>{const i=o.querySelector(".project-title").textContent.toLowerCase(),a=o.querySelector(".project-description").textContent.toLowerCase();return i.includes(t)||a.includes(t)}).slice(0,5).map(o=>{const i=o.querySelector(".project-title").textContent,a=o.dataset.category;return`
                <div class="search-suggestion-item" data-title="${i}">
                    <i class="fas fa-${w(a)}"></i>
                    <span>${i}</span>
                </div>
            `});s.length>0?(e.innerHTML=s.join(""),e.style.display="block",e.querySelectorAll(".search-suggestion-item").forEach(o=>{o.addEventListener("click",()=>{const i=document.getElementById("projectSearch");i.value=o.dataset.title,e.style.display="none",l(o.dataset.title.toLowerCase(),"all")})})):e.style.display="none"}function w(t){return{web:"globe",mobile:"mobile-alt",design:"palette",desktop:"desktop",game:"gamepad",ai:"brain"}[t]||"code"}function C(t){const e=document.getElementById("projectsContainer"),n=Array.from(e.children),s=document.createDocumentFragment();n.sort((o,i)=>{switch(t){case"date":return new Date(i.dataset.date)-new Date(o.dataset.date);case"name":return o.querySelector(".project-title").textContent.localeCompare(i.querySelector(".project-title").textContent);case"category":return o.dataset.category.localeCompare(i.dataset.category);default:return 0}}),n.forEach(o=>s.appendChild(o)),e.appendChild(s)}function q(t){const e=document.getElementById("projectDetailsModal");e.querySelector(".modal-title").textContent=t.title,e.querySelector(".project-description").textContent=t.description,e.querySelector(".tech-stack").innerHTML=t.technologies.map(a=>`
            <span class="tech-badge" title="${a}">
                <i class="fab fa-${a.toLowerCase()}"></i>
                ${a}
            </span>
        `).join(""),e.querySelector(".features-list").innerHTML=t.features.map(a=>`<li>${a}</li>`).join("");const n=e.querySelector(".main-image img"),s=e.querySelector(".thumbnail-list");t.images&&t.images.length>0?(n.src=t.images[0],n.alt=`Project image for ${t.title}`,s.innerHTML=t.images.map((a,c)=>`
                <img src="${a}" 
                     alt="Thumbnail ${c+1}" 
                     class="thumbnail ${c===0?"active":""}"
                     onclick="updateMainImage(${c})">
            `).join("")):(n.src="",n.alt="",s.innerHTML="");const o=e.querySelector(".demo-link"),i=e.querySelector(".source-link");t.demo_url?(o.href=t.demo_url,o.style.display="inline-flex",o.setAttribute("aria-label",`View live demo for ${t.title}`)):o.style.display="none",t.source_url?(i.href=t.source_url,i.style.display="inline-flex",i.setAttribute("aria-label",`View source code for ${t.title}`)):i.style.display="none"}function k(t){const e=document.getElementById("projectDetailsModal"),n=e.querySelector(".main-image img"),s=e.querySelectorAll(".thumbnail");n.src=s[t].src,s.forEach(o=>o.classList.remove("active")),s[t].classList.add("active")}window.showToast=function(t,e="info"){let n=document.querySelector(".toast-container");n||(n=document.createElement("div"),n.className="toast-container",document.body.appendChild(n));const s=document.createElement("div");s.className=`toast toast-${e}`,s.innerHTML=`
        <span class="toast-icon">
            <i class="fas fa-${e==="success"?"check-circle":e==="error"?"times-circle":"info-circle"}"></i>
        </span>
        <span>${t}</span>
        <button class="toast-close" aria-label="Close">&times;</button>
    `,n.appendChild(s),requestAnimationFrame(()=>s.classList.add("show")),s.querySelector(".toast-close").onclick=()=>s.remove(),setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>s.remove(),300)},4e3)};function I(){document.querySelectorAll("button, .btn, .action-btn, .edit-btn, .delete-btn").forEach(t=>{t.tabIndex=0,t.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t.click())}),t.addEventListener("click",e=>{const n=document.createElement("span");n.className="ripple",n.style.left=`${e.offsetX}px`,n.style.top=`${e.offsetY}px`,t.appendChild(n),setTimeout(()=>n.remove(),600)})})}function x(){document.querySelectorAll("[title]").forEach(t=>{t.setAttribute("tabindex","0");const e=s=>{const o=document.createElement("div");o.className="custom-tooltip",o.textContent=t.getAttribute("title"),document.body.appendChild(o);const i=t.getBoundingClientRect();o.style.left=`${i.left+window.scrollX+i.width/2}px`,o.style.top=`${i.top+window.scrollY-30}px`,t._tooltip=o},n=()=>{t._tooltip&&t._tooltip.remove()};t.addEventListener("focus",e),t.addEventListener("blur",n),t.addEventListener("mouseenter",e),t.addEventListener("mouseleave",n)})}function A(){const t=document.getElementById("projectDetailsModal");if(!t)return;const e=t.querySelectorAll('a, button, input, [tabindex]:not([tabindex="-1"])'),n=e[0],s=e[e.length-1];t.addEventListener("keydown",o=>{o.key==="Escape"&&t.classList.remove("active"),o.key==="Tab"&&(o.shiftKey&&document.activeElement===n?(o.preventDefault(),s.focus()):!o.shiftKey&&document.activeElement===s&&(o.preventDefault(),n.focus()))})}
