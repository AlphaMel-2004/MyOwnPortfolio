const E=(e,t)=>{let s;return function(...a){const o=()=>{clearTimeout(s),e(...a)};clearTimeout(s),s=setTimeout(o,t)}};document.addEventListener("DOMContentLoaded",()=>{y()});function y(){g(),p(),b(),w(),x(),T(),k(),$()}function g(){const e=document.querySelector(".admin-sidebar"),t=document.querySelector(".sidebar-toggle"),s=document.querySelectorAll(".nav-item");t&&t.addEventListener("click",()=>{e.classList.toggle("active")}),document.addEventListener("click",n=>{window.innerWidth<=1024&&!e.contains(n.target)&&!t.contains(n.target)&&e.classList.contains("active")&&e.classList.remove("active")}),s.forEach(n=>{n.addEventListener("click",()=>{s.forEach(a=>a.classList.remove("active")),n.classList.add("active")})})}function p(){document.querySelectorAll(".stat-value").forEach(t=>{const s=parseInt(t.dataset.value),a=s/(2e3/16);let o=0;const r=()=>{o+=a,o<s?(t.textContent=Math.floor(o).toLocaleString(),requestAnimationFrame(r)):t.textContent=s.toLocaleString()},c=new IntersectionObserver(u=>{u.forEach(i=>{i.isIntersecting&&(r(),c.unobserve(i.target))})},{threshold:.5});c.observe(t)})}function b(){document.querySelectorAll(".admin-table").forEach(t=>{const s=t.querySelectorAll("th"),n=t.querySelector("tbody"),a=Array.from(n.querySelectorAll("tr"));s.forEach((o,r)=>{o.dataset.sortable!=="false"&&(o.style.cursor="pointer",o.addEventListener("click",()=>{const c=o.dataset.direction==="asc"?-1:1;o.dataset.direction=c===1?"asc":"desc",s.forEach(l=>l.classList.remove("asc","desc")),o.classList.add(c===1?"asc":"desc");const u=a.sort((l,v)=>{const h=l.children[r].textContent,L=v.children[r].textContent;return c*h.localeCompare(L,void 0,{numeric:!0})}),i=document.createDocumentFragment();u.forEach(l=>i.appendChild(l)),n.appendChild(i)}))}),a.forEach(o=>{o.addEventListener("mouseenter",()=>{o.style.transform="scale(1.01)",o.style.transition="transform 0.2s ease"}),o.addEventListener("mouseleave",()=>{o.style.transform="scale(1)"})})})}function w(){document.querySelectorAll("form").forEach(t=>{t.querySelectorAll("input, textarea, select").forEach(n=>{n.value&&n.parentElement.classList.add("has-value"),n.addEventListener("focus",()=>{n.parentElement.classList.add("focused")}),n.addEventListener("blur",()=>{n.parentElement.classList.remove("focused"),n.value?n.parentElement.classList.add("has-value"):n.parentElement.classList.remove("has-value")}),n.addEventListener("input",E(()=>{f(n)},300))}),t.addEventListener("submit",async n=>{if(n.preventDefault(),q(t)){const a=t.querySelector('[type="submit"]');a.disabled=!0,a.classList.add("loading");try{const o=new FormData(t),r=await fetch(t.action,{method:t.method,body:o,headers:{"X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error("Network response was not ok");const c=await r.json();showToast(c.message,"success"),c.redirect&&(window.location.href=c.redirect)}catch(o){console.error("Error:",o),showToast("An error occurred. Please try again.","error")}finally{a.disabled=!1,a.classList.remove("loading")}}})})}function f(e){const t=e.value.trim(),s=e.parentElement.querySelector(".error-message");return e.required&&!t?(d(e,s,"This field is required"),!1):e.type==="email"&&t&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)?(d(e,s,"Please enter a valid email address"),!1):e.minLength&&t.length<e.minLength?(d(e,s,`Minimum length is ${e.minLength} characters`),!1):e.maxLength&&t.length>e.maxLength?(d(e,s,`Maximum length is ${e.maxLength} characters`),!1):(S(e,s),!0)}function q(e){const t=e.querySelectorAll("input, textarea, select");let s=!0;return t.forEach(n=>{f(n)||(s=!1)}),s}function d(e,t,s){e.classList.add("error"),t&&(t.textContent=s,t.style.display="block")}function S(e,t){e.classList.remove("error"),t&&(t.style.display="none")}function x(){document.querySelectorAll(".modal").forEach(t=>{const s=t.querySelector(".close-btn"),n=t.querySelector(".modal-content"),a=()=>{t.classList.remove("active"),document.body.style.overflow=""};s&&s.addEventListener("click",a),t.addEventListener("click",o=>{o.target===t&&a()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&t.classList.contains("active")&&a()}),n.addEventListener("click",o=>{o.stopPropagation()})})}function T(){window.showToast=function(e,t="info"){const s=document.querySelector(".toast-container")||C(),n=document.createElement("div");n.className=`toast toast-${t}`,n.innerHTML=`
            <span class="toast-icon">
                <i class="fas fa-${A(t)}"></i>
            </span>
            <span>${e}</span>
            <button class="toast-close" aria-label="Close">&times;</button>
        `,s.appendChild(n),requestAnimationFrame(()=>n.classList.add("show")),n.querySelector(".toast-close").addEventListener("click",()=>m(n)),setTimeout(()=>{m(n)},5e3)}}function C(){const e=document.createElement("div");return e.className="toast-container",document.body.appendChild(e),e}function m(e){e.classList.remove("show"),setTimeout(()=>e.remove(),300)}function A(e){return{success:"check-circle",error:"times-circle",warning:"exclamation-circle",info:"info-circle"}[e]||"info-circle"}function k(){document.querySelectorAll("button, .btn").forEach(e=>{e.addEventListener("click",t=>{const s=document.createElement("span");s.className="ripple",s.style.left=`${t.offsetX}px`,s.style.top=`${t.offsetY}px`,e.appendChild(s),setTimeout(()=>s.remove(),600)}),e.dataset.loading&&e.addEventListener("click",()=>{e.disabled=!0,e.classList.add("loading"),e.textContent,e.innerHTML=`
                    <span class="spinner"></span>
                    ${e.dataset.loadingText||"Loading..."}
                `})})}function $(){document.querySelectorAll("[title]").forEach(e=>{e.setAttribute("tabindex","0");const t=n=>{const a=document.createElement("div");a.className="custom-tooltip",a.textContent=e.getAttribute("title"),document.body.appendChild(a);const o=e.getBoundingClientRect();a.style.left=`${o.left+window.scrollX+o.width/2}px`,a.style.top=`${o.top+window.scrollY-30}px`,e._tooltip=a},s=()=>{e._tooltip&&e._tooltip.remove()};e.addEventListener("focus",t),e.addEventListener("blur",s),e.addEventListener("mouseenter",t),e.addEventListener("mouseleave",s)})}
